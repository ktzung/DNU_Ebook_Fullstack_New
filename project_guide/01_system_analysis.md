# ğŸ” PHÃ‚N TÃCH Há»† THá»NG DNU SHOP (COMPLETE GUIDE)

## 1. PhÃ¡t biá»ƒu bÃ i toÃ¡n (Detailed Scenario)

*DÆ°á»›i Ä‘Ã¢y lÃ  mÃ´ táº£ chi tiáº¿t vá» hoáº¡t Ä‘á»™ng cá»§a há»‡ thá»‘ng, Ä‘Æ°á»£c dÃ¹ng lÃ m Ä‘áº§u vÃ o duy nháº¥t cho quÃ¡ trÃ¬nh phÃ¢n tÃ­ch.*

**"Há»‡ thá»‘ng DNU Shop lÃ  má»™t ná»n táº£ng thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ chuyÃªn cung cáº¥p cÃ¡c thiáº¿t bá»‹ cÃ´ng nghá»‡. Há»‡ thá»‘ng cÃ³ 2 nhÃ³m ngÆ°á»i dÃ¹ng chÃ­nh: KhÃ¡ch hÃ ng (Customer) vÃ  Quáº£n trá»‹ viÃªn (Admin). Táº¥t cáº£ ngÆ°á»i dÃ¹ng Ä‘á»u cÃ³ thÃ´ng tin cÆ¡ báº£n gá»“m Há» tÃªn, Email (duy nháº¥t) vÃ  Máº­t kháº©u (Ä‘Ã£ Ä‘Æ°á»£c mÃ£ hÃ³a).**

**Äá»‘i vá»›i Sáº¢N PHáº¨M (Product): Má»—i sáº£n pháº©m Ä‘Æ°á»£c bÃ y bÃ¡n Ä‘á»u thuá»™c vá» má»™t Danh má»¥c (Category) cá»¥ thá»ƒ (vÃ­ dá»¥: Äiá»‡n thoáº¡i, Laptop). Sáº£n pháº©m cáº§n lÆ°u trá»¯ cÃ¡c thÃ´ng tin chi tiáº¿t gá»“m: TÃªn sáº£n pháº©m, GiÃ¡ bÃ¡n hiá»‡n táº¡i, HÃ¬nh áº£nh minh há»a, MÃ´ táº£ ká»¹ thuáº­t vÃ  Sá»‘ lÆ°á»£ng tá»“n kho. Má»™t danh má»¥c cÃ³ thá»ƒ chá»©a nhiá»u sáº£n pháº©m, nhÆ°ng má»—i sáº£n pháº©m chá»‰ thuá»™c má»™t danh má»¥c.**

**Quy trÃ¬nh MUA HÃ€NG (Ordering): KhÃ¡ch hÃ ng sau khi Ä‘Äƒng nháº­p cÃ³ thá»ƒ chá»n mua nhiá»u sáº£n pháº©m. Khi khÃ¡ch hÃ ng quyáº¿t Ä‘á»‹nh 'Äáº·t hÃ ng', há»‡ thá»‘ng sáº½ táº¡o ra má»™t ÄÆ¡n hÃ ng (Order). Má»™t ÄÆ¡n hÃ ng pháº£i chá»©a thÃ´ng tin vá»: NgÃ y Ä‘áº·t hÃ ng, Tá»•ng tiá»n thanh toÃ¡n, TÃªn ngÆ°á»i nháº­n, SÄT ngÆ°á»i nháº­n vÃ  Äá»‹a chá»‰ giao hÃ ng. Äáº·c biá»‡t, má»™t Ä‘Æ¡n hÃ ng bao gá»“m nhiá»u dÃ²ng sáº£n pháº©m, má»—i dÃ²ng Ä‘Æ°á»£c gá»i lÃ  Chi tiáº¿t Ä‘Æ¡n hÃ ng (OrderDetail). Má»—i Chi tiáº¿t Ä‘Æ¡n hÃ ng ghi nháº­n láº¡i Sáº£n pháº©m nÃ o Ä‘Æ°á»£c mua, Sá»‘ lÆ°á»£ng bao nhiÃªu vÃ  GiÃ¡ bÃ¡n táº¡i thá»i Ä‘iá»ƒm mua (Ä‘á»ƒ lÆ°u váº¿t lá»‹ch sá»­ giÃ¡ náº¿u giÃ¡ gá»‘c thay Ä‘á»•i).**

**Quy trÃ¬nh QUáº¢N LÃ (Management): Quáº£n trá»‹ viÃªn cáº§n theo dÃµi tráº¡ng thÃ¡i cá»§a ÄÆ¡n hÃ ng. Má»™t Ä‘Æ¡n hÃ ng sáº½ cÃ³ cÃ¡c tráº¡ng thÃ¡i chuyá»ƒn Ä‘á»•i tuáº§n tá»±: Má»›i (New) -> Äang giao (Shipping) -> HoÃ n thÃ nh (Completed) hoáº·c bá»‹ Há»§y (Cancelled). Quáº£n trá»‹ viÃªn cÅ©ng quáº£n lÃ½ kho hÃ ng báº±ng cÃ¡ch cáº­p nháº­t Sá»‘ lÆ°á»£ng tá»“n kho cá»§a sáº£n pháº©m."**

---

## 2. PhÆ°Æ¡ng phÃ¡p PhÃ¢n tÃ­ch (Analysis Methodology)

Quy trÃ¬nh chuyá»ƒn Ä‘á»•i tá»« **Scenario** sang **Thiáº¿t káº¿** gá»“m 3 bÆ°á»›c:

1.  **PhÃ¢n tÃ­ch Danh tá»« (Noun Analysis)** $\to$ XÃ¡c Ä‘á»‹nh **Entities** (Thá»±c thá»ƒ) vÃ  **Attributes** (Thuá»™c tÃ­nh).
2.  **PhÃ¢n tÃ­ch Äá»™ng tá»« (Verb Analysis)** $\to$ XÃ¡c Ä‘á»‹nh **Relationships** (Quan há»‡) vÃ  **Methods** (PhÆ°Æ¡ng thá»©c).
3.  **MÃ´ hÃ¬nh hÃ³a (Modeling)** $\to$ Váº½ **Class Diagram** vÃ  **ERD**.

### 2.1. BÆ°á»›c 1: PhÃ¢n tÃ­ch Danh tá»« (Noun Analysis)

*Liá»‡t kÃª TOÃ€N Bá»˜ danh tá»« xuáº¥t hiá»‡n trong Scenario vÃ  phÃ¢n loáº¡i.*

| Danh tá»« (Trong vÄƒn báº£n) | PhÃ¢n loáº¡i | Giáº£i thÃ­ch / Ãnh xáº¡ |
| :--- | :--- | :--- |
| **Há»‡ thá»‘ng DNU Shop** | Bá» qua | Pháº¡m vi há»‡ thá»‘ng, khÃ´ng pháº£i Ä‘á»‘i tÆ°á»£ng dá»¯ liá»‡u. |
| **KhÃ¡ch hÃ ng (Customer)** | `Role` / `User` | LÃ  má»™t loáº¡i ngÆ°á»i dÃ¹ng. Ãnh xáº¡ vÃ o entity **User** (vá»›i Role='Customer'). |
| **Quáº£n trá»‹ viÃªn (Admin)** | `Role` / `User` | LÃ  má»™t loáº¡i ngÆ°á»i dÃ¹ng. Ãnh xáº¡ vÃ o entity **User** (vá»›i Role='Admin'). |
| **NgÆ°á»i dÃ¹ng** | **Entity** | Thá»±c thá»ƒ cha, quáº£n lÃ½ thÃ´ng tin Ä‘Äƒng nháº­p chung. $\to$ Table `AspNetUsers` |
| **Há» tÃªn, Email, Máº­t kháº©u** | **Attribute** | Thuá»™c tÃ­nh cá»§a `User`. |
| **Sáº£n pháº©m (Product)** | **Entity** | Äá»‘i tÆ°á»£ng hÃ ng hÃ³a. $\to$ Table `Products` |
| **Danh má»¥c (Category)** | **Entity** | Äá»‘i tÆ°á»£ng phÃ¢n loáº¡i. $\to$ Table `Categories` |
| **TÃªn SP, GiÃ¡, HÃ¬nh áº£nh, MÃ´ táº£, Tá»“n kho** | **Attribute** | Thuá»™c tÃ­nh cá»§a `Product`. |
| **ÄÆ¡n hÃ ng (Order)** | **Entity** | Äá»‘i tÆ°á»£ng giao dá»‹ch chÃ­nh. $\to$ Table `Orders` |
| **NgÃ y Ä‘áº·t, Tá»•ng tiá»n** | **Attribute** | Thuá»™c tÃ­nh cá»§a `Order`. |
| **TÃªn ngÆ°á»i nháº­n, SÄT, Äá»‹a chá»‰** | **Attribute** | Thuá»™c tÃ­nh cá»§a `Order` (ThÃ´ng tin giao hÃ ng). |
| **Chi tiáº¿t Ä‘Æ¡n hÃ ng (OrderDetail)** | **Entity** | Äá»‘i tÆ°á»£ng trung gian (Order-Product). $\to$ Table `OrderItems` |
| **Sá»‘ lÆ°á»£ng (mua)** | **Attribute** | Thuá»™c tÃ­nh cá»§a `OrderDetail`. |
| **GiÃ¡ bÃ¡n (táº¡i thá»i Ä‘iá»ƒm mua)** | **Attribute** | Thuá»™c tÃ­nh cá»§a `OrderDetail` (LÆ°u Ã½: KhÃ¡c vá»›i giÃ¡ hiá»‡n táº¡i cá»§a SP). |
| **Tráº¡ng thÃ¡i (Status)** | **Attribute** | Thuá»™c tÃ­nh cá»§a `Order` (New, Shipping... ). |

**ğŸ‘‰ Káº¾T QUáº¢ BÆ¯á»šC 1: Danh sÃ¡ch Thá»±c thá»ƒ (Entities)**
1.  **User** (NgÆ°á»i dÃ¹ng)
2.  **Product** (Sáº£n pháº©m)
3.  **Category** (Danh má»¥c)
4.  **Order** (ÄÆ¡n hÃ ng)
5.  **OrderDetail** (Chi tiáº¿t Ä‘Æ¡n hÃ ng)

---

### 2.2. BÆ°á»›c 2: PhÃ¢n tÃ­ch Äá»™ng tá»« (Verb Analysis)

*XÃ¡c Ä‘á»‹nh má»‘i quan há»‡ giá»¯a cÃ¡c thá»±c thá»ƒ dá»±a trÃªn hÃ nh Ä‘á»™ng.*

| Äá»™ng tá»« / Má»‘i quan há»‡ | PhÃ¢n tÃ­ch quan há»‡ (Cardinality) | PhÆ°Æ¡ng thá»©c (Methods) |
| :--- | :--- | :--- |
| Sáº£n pháº©m **thuá»™c vá»** Danh má»¥c | **Category (1) -- (n) Product** <br> *(1 Danh má»¥c cÃ³ nhiá»u SP, 1 SP thuá»™c 1 Danh má»¥c)* | `GetProductsByCategory(cateId)` |
| KhÃ¡ch hÃ ng **quyáº¿t Ä‘á»‹nh / táº¡o** ÄÆ¡n hÃ ng | **User (1) -- (n) Order** <br> *(1 KhÃ¡ch cÃ³ nhiá»u Ä‘Æ¡n, 1 ÄÆ¡n thuá»™c 1 KhÃ¡ch)* | `CreateOrder(userId, cartData)` |
| ÄÆ¡n hÃ ng **bao gá»“m** Chi tiáº¿t | **Order (1) -- (n) OrderDetail** <br> *(1 ÄÆ¡n cÃ³ nhiá»u dÃ²ng chi tiáº¿t)* | `GetOrderDetails(orderId)` |
| Chi tiáº¿t **ghi nháº­n** Sáº£n pháº©m | **Product (1) -- (n) OrderDetail** <br> *(1 SP xuáº¥t hiá»‡n trong nhiá»u Ä‘Æ¡n khÃ¡c nhau)* | `GetProductSalesHistory(productId)` |
| Quáº£n trá»‹ viÃªn **cáº­p nháº­t** Tá»“n kho | TÃ¡c Ä‘á»™ng lÃªn thuá»™c tÃ­nh `Stock` cá»§a Product | `UpdateStock(productId, newQuantity)` |
| Quáº£n trá»‹ viÃªn **chuyá»ƒn tráº¡ng thÃ¡i** ÄÆ¡n hÃ ng | TÃ¡c Ä‘á»™ng lÃªn thuá»™c tÃ­nh `Status` cá»§a Order | `UpdateOrderStatus(orderId, newStatus)` |

---

## 3. Thiáº¿t káº¿ Há»‡ thá»‘ng (System Design)

### 3.1. Biá»ƒu Ä‘á»“ Lá»›p (Class Diagram)

*Biá»ƒu Ä‘á»“ nÃ y Ä‘Æ°á»£c suy ra TRá»°C TIáº¾P tá»« káº¿t quáº£ phÃ¢n tÃ­ch Danh tá»« (Entities/Attributes) vÃ  Äá»™ng tá»« (Relationships/Methods) á»Ÿ trÃªn.*

```mermaid
classDiagram
    %% Entities
    class User {
        +String Id
        +String FullName
        +String Email
        +String PasswordHash
        +Role Enum
        +Login()
        +Register()
    }

    class Category {
        +Integer Id
        +String Name
        +String Description
    }

    class Product {
        +Integer Id
        +String Name
        +Decimal Price
        +String ImageUrl
        +String Description
        +Integer Stock
        +UpdateStock()
    }

    class Order {
        +Integer Id
        +DateTime CreatedDate
        +Decimal TotalAmount
        +String ShippingAddress
        +String ShippingPhone
        +OrderStatus Status
        +UpdateStatus()
    }

    class OrderDetail {
        +Integer Id
        +Integer Quantity
        +Decimal UnitPrice
        +Decimal Subtotal
    }

    %% Relationships
    Category "1" -- "0..*" Product : Contains >
    User "1" -- "0..*" Order : Places >
    Order "1" -- "1..*" OrderDetail : Has >
    Product "1" -- "0..*" OrderDetail : Included in >
```

### 3.2. LÆ°á»£c Ä‘á»“ CÆ¡ sá»Ÿ dá»¯ liá»‡u (Database Schema)

*Chuyá»ƒn Ä‘á»•i tá»« Class Diagram sang ERD (Entity Relationship Diagram) váº­t lÃ½.
LÆ°u Ã½: Báº£ng `User` sáº½ mapping vá»›i `AspNetUsers` cá»§a Identity Framework.*

```mermaid
erDiagram
    AspNetUsers ||--o{ Orders : "1 User has many Orders"
    Categories ||--o{ Products : "1 Category has many Products"
    Products ||--o{ OrderItems : "1 Product in many OrderItems"
    Orders ||--o{ OrderItems : "1 Order has many OrderItems"

    AspNetUsers {
        string Id PK "UUID"
        string Email "Unique"
        string PasswordHash
        string FullName
    }

    Categories {
        int Id PK
        string Name
    }

    Products {
        int Id PK
        string Name
        decimal Price
        int Stock
        int CategoryId FK
    }

    Orders {
        int Id PK
        string UserId FK
        datetime CreatedDate
        decimal TotalAmount
        int Status "Enum: New, Shipping, Done, Cancelled"
        string ShippingAddress
    }

    OrderItems {
        int Id PK
        int OrderId FK
        int ProductId FK
        int Quantity
        decimal UnitPrice "Snapshot Price"
    }
```

## 4. Tá»•ng káº¿t

Quy trÃ¬nh phÃ¢n tÃ­ch tá»« vÄƒn báº£n Ä‘áº¿n thiáº¿t káº¿ CSDL Ä‘Ã£ hoÃ n táº¥t:
1.  **Input**: Scenario chi tiáº¿t (Má»¥c 1).
2.  **Analysis**: Báº£ng Danh tá»« & Äá»™ng tá»« (Má»¥c 2).
3.  **Output**: Class Diagram & ERD (Má»¥c 3).

CÃ¡c bÆ°á»›c tiáº¿p theo (Coding) sáº½ bÃ¡m sÃ¡t vÃ o cÃ¡c model nÃ y Ä‘á»ƒ Ä‘áº£m báº£o Ä‘Ãºng yÃªu cáº§u nghiá»‡p vá»¥.
